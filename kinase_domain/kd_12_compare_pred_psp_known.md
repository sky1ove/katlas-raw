

``` python
import pandas as pd
from katlas.pssm import *
from matplotlib import pyplot as plt
from functools import partial
```

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
df = pd.read_csv('raw/psp_ks_dataset_2408.csv')
```

``` python
df['kin_uniprot'] = df.KIN_ACC_ID.str.split('-').str[0]
```

``` python
df.kin_uniprot.value_counts()
```

    kin_uniprot
    P17612    1105
    P06493     816
    P68400     799
    P17252     772
    P12931     753
              ... 
    O54988       1
    Q9BRS2       1
    Q80X41       1
    O55098       1
    Q5U4C9       1
    Name: count, Length: 834, dtype: int64

``` python
nonhuman = (df.KIN_ORGANISM.value_counts()>13)[lambda x: x].index[1:]
```

``` python
nonhuman
```

    Index(['mouse', 'rat', 'cow', 'chicken', 'rabbit', 'pig', 'herpesvirus'], dtype='object', name='KIN_ORGANISM')

``` python
df = df[df.KIN_ORGANISM.isin(nonhuman)]
```

``` python
df.shape
```

    (4759, 17)

``` python
df['sub_uniprot']=df.SUB_ACC_ID.str.split('-').str[0]
```

``` python
df['sub_site'] = df.sub_uniprot+"_"+df.SUB_MOD_RSD
```

``` python
df.shape
```

    (4759, 19)

``` python
# remove sub site duplicates for each kinase
df = df.drop_duplicates(subset=['kin_uniprot','sub_site'])
```

``` python
df.shape
```

    (4734, 19)

``` python
kin_idxs = (df.kin_uniprot.value_counts()>=30)[lambda x: x].index
```

``` python
pred_pspa=pd.read_parquet('raw/pred_new_pspa.parquet')
pred_cddm=pd.read_parquet('raw/pred_new_cddm.parquet')
```

``` python
idxs = pred_pspa.index.str.split('_').str[0]
```

``` python
idxs.isin(df.kin_uniprot).sum()
```

    np.int64(322)

``` python
idxs.isin(kin_idxs).sum()
```

    np.int64(34)

``` python
df['site_seq'] = df['SITE_+/-7_AA']
```

``` python
psp_nonhuman = get_cluster_pssms(df,cluster_col = 'kin_uniprot',count_thr=30)
```

    100%|███████████████████████████████████████████████████████████████████████████████████████████| 391/391 [00:00<00:00, 706.09it/s]

``` python
idx_overlap = list(set(idxs)&set(psp_nonhuman.index))
```

``` python
ori_index = pred_pspa.index
```

``` python
pred_pspa.index=pred_pspa.index.str.split('_').str[0]
```

``` python
pred_pspa = pred_pspa.loc[idx_overlap]
nonhuman_pspa = psp_nonhuman.loc[idx_overlap]
```

## Comopare the two

``` python
def score_df(target,pred,func):
    cols = list(set(target.columns)&set(pred.columns))
    distance = [func(target.loc[i,cols],pred.loc[i,cols]) for i in target.index]
    return pd.Series(distance,index=target.index)
```

``` python
jsd_df = partial(score_df,func=js_divergence_flat)
```

``` python
jsd_score = jsd_df(nonhuman_pspa,pred_pspa).sort_values()
```

``` python
pred_pspa,nonhuman_pspa = pred_pspa.align(nonhuman_pspa,join='inner')
```

``` python
for idx,score in jsd_score.items():
    pssm1 = recover_pssm(nonhuman_pspa.loc[idx])
    pssm2 = recover_pssm(pred_pspa.loc[idx])
    
    plot_two_heatmaps(pssm1,pssm2,f'{idx}:{score:.3f}','PSP','Predicted',scale_01=False)
    plt.show()
    plt.close()
    # break
```

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-1.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-2.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-3.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-4.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-5.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-6.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-7.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-8.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-9.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-10.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-11.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-12.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-13.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-14.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-15.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-16.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-17.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-18.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-19.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-20.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-21.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-22.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-23.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-24.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-25.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-26.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-27.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-28.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-29.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-30.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-31.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-32.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-33.png)

![](kd_12_compare_pred_psp_known_files/figure-commonmark/cell-30-output-34.png)
