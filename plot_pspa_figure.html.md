# PSPA figures


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

``` python
from katlas.data import *
from katlas.utils import *
from katlas.pssm import *
from katlas.plot import *
from tqdm import tqdm
import numpy as np
```

``` python
pspa= Data.get_pspa_all_norm()
```

    ‚¨áÔ∏è Downloading katlas_dataset.zip ...

    Downloading...
    From (original): https://drive.google.com/uc?id=17wIl0DbdoHV036Z3xgaT_0H3LlM_W47l
    From (redirected): https://drive.google.com/uc?id=17wIl0DbdoHV036Z3xgaT_0H3LlM_W47l&confirm=t&uuid=92b66229-0f35-4442-b590-c54c406e4795
    To: /home/sky1ove/git/katlas-raw/nbs/katlas_datasets.zip
    100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 209M/209M [00:05<00:00, 37.6MB/s]

    üìÇ Extracting to /tmp/katlas_dataset ...
    üßπ Removing zip file: katlas_datasets.zip
    ‚úÖ Done! Extracted dataset is at: /tmp/katlas_dataset

``` python
pspa.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
&#10;    .dataframe tbody tr th {
        vertical-align: top;
    }
&#10;    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">-5P</th>
<th data-quarto-table-cell-role="th">-5G</th>
<th data-quarto-table-cell-role="th">-5A</th>
<th data-quarto-table-cell-role="th">-5C</th>
<th data-quarto-table-cell-role="th">-5S</th>
<th data-quarto-table-cell-role="th">-5T</th>
<th data-quarto-table-cell-role="th">-5V</th>
<th data-quarto-table-cell-role="th">-5I</th>
<th data-quarto-table-cell-role="th">-5L</th>
<th data-quarto-table-cell-role="th">-5M</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">5H</th>
<th data-quarto-table-cell-role="th">5K</th>
<th data-quarto-table-cell-role="th">5R</th>
<th data-quarto-table-cell-role="th">5Q</th>
<th data-quarto-table-cell-role="th">5N</th>
<th data-quarto-table-cell-role="th">5D</th>
<th data-quarto-table-cell-role="th">5E</th>
<th data-quarto-table-cell-role="th">5s</th>
<th data-quarto-table-cell-role="th">5t</th>
<th data-quarto-table-cell-role="th">5y</th>
</tr>
<tr>
<th data-quarto-table-cell-role="th">kinase</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr>
<td data-quarto-table-cell-role="th">AAK1</td>
<td>0.0720</td>
<td>0.0245</td>
<td>0.0284</td>
<td>0.0456</td>
<td>0.0425</td>
<td>0.0425</td>
<td>0.0951</td>
<td>0.1554</td>
<td>0.0993</td>
<td>0.0864</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">ACVR2A</td>
<td>0.0415</td>
<td>0.0481</td>
<td>0.0584</td>
<td>0.0489</td>
<td>0.0578</td>
<td>0.0578</td>
<td>0.0598</td>
<td>0.0625</td>
<td>0.0596</td>
<td>0.0521</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">ACVR2B</td>
<td>0.0533</td>
<td>0.0517</td>
<td>0.0566</td>
<td>0.0772</td>
<td>0.0533</td>
<td>0.0533</td>
<td>0.0543</td>
<td>0.0442</td>
<td>0.0471</td>
<td>0.0516</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">AKT1</td>
<td>0.0603</td>
<td>0.0594</td>
<td>0.0552</td>
<td>0.0605</td>
<td>0.0516</td>
<td>0.0516</td>
<td>0.0427</td>
<td>0.0435</td>
<td>0.0464</td>
<td>0.0505</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td data-quarto-table-cell-role="th">AKT2</td>
<td>0.0602</td>
<td>0.0617</td>
<td>0.0643</td>
<td>0.0582</td>
<td>0.0534</td>
<td>0.0534</td>
<td>0.0433</td>
<td>0.0418</td>
<td>0.0493</td>
<td>0.0513</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows √ó 236 columns</p>
</div>

If using uniprot+gene name, change the index following the commented
code:

``` python
# info = Data.get_kinase_info()

# info = info[info.pseudo=='0'].copy()

# info['uniprot_gene'] = info['uniprot'] + '_' + info['gene']

# id_map = info[['kinase','uniprot_gene']].drop_duplicates().set_index('kinase')['uniprot_gene']

# parts = pspa.index.str.split('_')
# first = parts.str[0].map(id_map)
# second = parts.str.get(1)

# new_index = first + np.where(second.notna(), '_' + second, '')

# pspa.index=new_index
```

``` python
pspa.index.duplicated().sum()
```

    np.int64(0)

``` python
SHOW=False
```

``` python
def plot_logo_pspa(row,title='Motif',figsize=(5,2)):
    pssm = recover_pssm_pspa(row)
    logo_pssm = preprocess_pssm_pspa(pssm)
    plot_logo_raw(logo_pssm,ytitle='log‚ÇÇ(Value / Median)',title=title,figsize=figsize)
```

``` python
for k, row in tqdm(pspa.iterrows(),total=len(pspa)): 
    plot_logo_heatmap_pspa(row,title=k,figsize=(5,10))
    path1=prepare_path(f'fig/pspa/{k}/pssm.svg')
    save_show(path1,show_only=SHOW)

    plot_logo_pspa(row,title=k,figsize=(4,1.7))
    path2=prepare_path(f'fig/pspa/{k}/logo.svg')
    save_show(path2,show_only=SHOW)
    # break
```

    100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 396/396 [20:14<00:00,  3.07s/it]

``` python
len(pspa)
```

    396
